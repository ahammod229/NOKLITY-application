
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOKLITY Admin | Modern Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              brand: {
                red: '#E50044', // NOKLITY Red
                black: '#111111', 
                gray: '#F3F4F6', 
              }
            }
          }
        }
      }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        .nav-item.active { background-color: #E50044; color: white; box-shadow: 0 4px 6px -1px rgba(229, 0, 68, 0.4); }
        .nav-item.active i { color: white; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 200ms; }
        
        /* Modal Tabs */
        .tab-btn.active { border-bottom: 2px solid #E50044; color: #E50044; font-weight: 600; }
        .tab-btn { color: #6B7280; font-weight: 500; }
        .dark .tab-btn { color: #9CA3AF; }
        .dark .tab-btn.active { color: #F87171; border-bottom-color: #F87171; }

        /* Settings Sidebar Active State */
        .settings-nav-item.active { background-color: #FEF2F2; color: #E50044; font-weight: 600; border-left: 3px solid #E50044; }
        .dark .settings-nav-item.active { background-color: #374151; color: #F87171; border-left-color: #F87171; }
        .settings-nav-item { border-left: 3px solid transparent; }
        
        /* AI Pulse Animation */
        @keyframes sparkle-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .ai-loading { animation: sparkle-pulse 1s infinite; cursor: wait; }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-100 bg-[#F3F4F6] dark:bg-gray-900 h-screen flex overflow-hidden transition-colors duration-200">
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-5 right-5 z-[60] flex flex-col gap-3"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-100 dark:bg-gray-900 transition-colors duration-200">
        <div class="w-full max-w-sm p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 text-center">
            <div class="flex justify-center mb-6">
                <div class="w-12 h-12 flex items-center justify-center">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                        <path d="M20 20 V80 L50 50 L20 20 Z" fill="#E50044"/>
                        <path d="M80 80 V20 L50 50 L80 80 Z" fill="#111111" class="dark:fill-white"/>
                    </svg>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-brand-black dark:text-white mb-1">Welcome Back</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Sign in to manage NOKLITY.</p>
            <form id="login-form" class="space-y-4 text-left">
                <div>
                    <label class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">Username</label>
                    <input id="username" type="text" placeholder="Default: admin" class="mt-1 w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent outline-none transition-all dark:text-white">
                </div>
                <div>
                    <label class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">Password</label>
                    <input id="password" type="password" placeholder="Default: Ilovemoney" class="mt-1 w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent outline-none transition-all dark:text-white">
                </div>
                <p id="login-error" class="text-xs text-red-500 text-center hidden">Invalid username or password.</p>
                <button type="submit" class="w-full bg-brand-red text-white font-bold py-3 rounded-xl hover:bg-red-700 shadow-lg shadow-red-200 transition-all transform hover:-translate-y-0.5">Sign In</button>
            </form>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container" class="flex w-full h-full hidden relative">
        
        <!-- Mobile Sidebar Overlay -->
        <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 border-r border-gray-100 dark:border-gray-700 flex flex-col z-40 shadow-sm transition-transform duration-300 fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0">
            <div class="h-20 flex items-center px-8 border-b border-gray-50 dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8" id="sidebar-logo-container">
                        <svg viewBox="0 0 100 100" fill="none" class="w-full h-full">
                            <path d="M20 20 V80 L50 50 L20 20 Z" fill="#E50044"/>
                            <path d="M80 80 V20 L50 50 L80 80 Z" fill="#111111" class="dark:fill-white"/>
                        </svg>
                    </div>
                    <span class="font-bold text-xl text-brand-black dark:text-white tracking-tight" id="sidebar-site-name">NOKLITY</span>
                </div>
            </div>
            <nav class="flex-1 py-6 px-4 space-y-2 overflow-y-auto">
                <p class="px-4 text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-2">Analytics</p>
                <a href="#" onclick="showSection('dashboard'); toggleSidebarOnMobile();" id="nav-dashboard" class="nav-item active flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-squares-four text-lg mr-3"></i> Dashboard
                </a>
                <a href="#" onclick="showSection('finance'); toggleSidebarOnMobile();" id="nav-finance" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-chart-line-up text-lg mr-3"></i> Finance
                </a>
                <p class="px-4 text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-2 mt-4">Management</p>
                <a href="#" onclick="showSection('orders'); toggleSidebarOnMobile();" id="nav-orders" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-shopping-cart text-lg mr-3"></i> Orders
                </a>
                <a href="#" onclick="showSection('products'); toggleSidebarOnMobile();" id="nav-products" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-package text-lg mr-3"></i> Products
                </a>
                <a href="#" onclick="showSection('websites'); toggleSidebarOnMobile();" id="nav-websites" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-globe text-lg mr-3"></i> Websites
                </a>
                <a href="#" onclick="showSection('reviews'); toggleSidebarOnMobile();" id="nav-reviews" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-star text-lg mr-3"></i> Reviews
                </a>
                <p class="px-4 text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase mb-2 mt-4">System</p>
                <a href="#" onclick="showSection('marketing'); toggleSidebarOnMobile();" id="nav-marketing" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-megaphone text-lg mr-3"></i> Marketing
                </a>
                <a href="#" onclick="showSection('users'); toggleSidebarOnMobile();" id="nav-users" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-users text-lg mr-3"></i> Customers
                </a>
                <a href="#" onclick="showSection('settings'); toggleSidebarOnMobile();" id="nav-settings" class="nav-item flex items-center px-4 py-3 rounded-xl text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                    <i class="ph ph-gear text-lg mr-3"></i> Settings
                </a>
            </nav>
            <div class="p-4 border-t border-gray-50 dark:border-gray-700">
                <a href="#" onclick="logout()" class="flex items-center px-4 py-3 rounded-xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 transition-all">
                    <i class="ph ph-sign-out text-lg mr-3"></i> Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col h-full bg-[#F9FAFB] dark:bg-gray-900 overflow-hidden transition-colors duration-200">
            <header class="h-20 bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between px-4 md:px-8 z-10 transition-colors duration-200">
               <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="md:hidden text-gray-600 dark:text-gray-300 hover:text-brand-red transition-colors p-2 -ml-2 focus:outline-none"><i class="ph ph-list text-2xl"></i></button>
                    <h1 class="text-xl font-bold text-gray-800 dark:text-white truncate" id="page-title">Dashboard</h1>
                </div>
                <div class="flex items-center gap-4">
                    <div id="live-indicator" class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 rounded-full text-xs font-semibold animate-pulse">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div> Live Sync
                    </div>
                    <a href="/" target="_blank" class="hidden md:flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-brand-red transition-colors">
                        <i class="ph ph-storefront text-lg"></i> View Store
                    </a>
                    <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all"><i id="theme-icon" class="ph ph-moon text-xl"></i></button>
                    <div class="hidden md:block">
                        <p class="text-sm font-bold text-gray-800 dark:text-white" id="header-username">Admin</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400" id="header-role">Super Admin</p>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8">
                <!-- Dashboard Section -->
                <div id="section-dashboard" class="space-y-8 animate-fade-in">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 flex justify-between items-start"><div><p class="text-sm text-gray-500 dark:text-gray-400 font-medium mb-1">Total Sales</p><h3 class="text-2xl font-bold text-gray-900 dark:text-white" id="dash-sales">৳0</h3></div><div class="w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400"><i class="ph ph-currency-dollar text-xl"></i></div></div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 flex justify-between items-start"><div><p class="text-sm text-gray-500 dark:text-gray-400 font-medium mb-1">Total Orders</p><h3 class="text-2xl font-bold text-gray-900 dark:text-white" id="dash-orders">0</h3></div><div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"><i class="ph ph-shopping-cart text-xl"></i></div></div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 flex justify-between items-start"><div><p class="text-sm text-gray-500 dark:text-gray-400 font-medium mb-1">Total Products</p><h3 class="text-2xl font-bold text-gray-900 dark:text-white" id="dash-products">0</h3></div><div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400"><i class="ph ph-package text-xl"></i></div></div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 flex justify-between items-start"><div><p class="text-sm text-gray-500 dark:text-gray-400 font-medium mb-1">Websites</p><h3 class="text-2xl font-bold text-gray-900 dark:text-white" id="dash-websites">0</h3></div><div class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400"><i class="ph ph-globe text-xl"></i></div></div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="section-orders" class="hidden space-y-8 animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Orders Management</h2>
                        <button onclick="exportOrders()" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center"><i class="ph ph-download-simple mr-2"></i> Export CSV</button>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-50/50 dark:bg-gray-700 border-b border-gray-100 dark:border-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider">Customer</th>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider">Payment</th>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider text-right">Total</th>
                                        <th class="px-6 py-4 text-xs font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="order-list-body" class="divide-y divide-gray-50 dark:divide-gray-700 dark:text-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div id="section-products" class="hidden space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-bold text-gray-800 dark:text-white">Products Inventory</h2>
                        <button onclick="openProductModal()" class="bg-brand-red text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-700 shadow-md transition-all flex items-center">
                            <i class="ph ph-plus mr-2"></i> Add Product
                        </button>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 dark:bg-gray-700 border-b border-gray-100 dark:border-gray-700"><tr><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase">Product</th><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase">Category</th><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase">Price</th><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase">Stock</th><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase">Status</th><th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase text-right">Actions</th></tr></thead>
                                <tbody id="product-list-body" class="divide-y divide-gray-50 dark:divide-gray-700 dark:text-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Pagination Controls -->
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500 dark:text-gray-400" id="pagination-info">Showing 0-0 of 0</span>
                        <div class="flex gap-2">
                            <button onclick="prevProductPage()" id="btn-prev" class="px-3 py-1 text-sm border border-gray-200 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300">Previous</button>
                            <button onclick="nextProductPage()" id="btn-next" class="px-3 py-1 text-sm border border-gray-200 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Placeholders for other sections to keep script running -->
                <div id="section-finance" class="hidden"></div>
                <div id="section-users" class="hidden"></div>
                <div id="section-websites" class="hidden"></div>
                <div id="section-reviews" class="hidden"></div>
                <div id="section-marketing" class="hidden"></div>
                <div id="section-settings" class="hidden"></div>

            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-40 backdrop-blur-sm" onclick="toggleModal('productModal', false)"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col animate-fade-in m-4 md:m-0">
            <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white" id="productModalTitle">Add New Product</h3>
                <button onclick="toggleModal('productModal', false)" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"><i class="ph ph-x text-xl"></i></button>
            </div>
            <div class="flex border-b border-gray-100 dark:border-gray-700 px-6 space-x-6 overflow-x-auto">
                <button type="button" class="tab-btn active py-3 text-sm focus:outline-none whitespace-nowrap" onclick="switchTab('tab-general')">General Info</button>
                <button type="button" class="tab-btn py-3 text-sm focus:outline-none whitespace-nowrap" onclick="switchTab('tab-details')">Images & Description</button>
                <button type="button" class="tab-btn py-3 text-sm focus:outline-none whitespace-nowrap" onclick="switchTab('tab-shipping')">Shipping & Warranty</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900">
                <form id="productForm" class="space-y-6">
                    <input type="hidden" id="p-id">
                    <!-- General Tab -->
                    <div id="tab-general" class="tab-content space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Name *</label>
                                <input type="text" id="p-name" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-red outline-none dark:bg-gray-800 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category *</label>
                                <select id="p-category" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none bg-white dark:bg-gray-800 dark:text-white">
                                    <option value="electronics">Electronics</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="tools">Tools</option>
                                    <option value="health">Health & Beauty</option>
                                    <option value="tyres">Tyres & Automotive</option>
                                    <option value="spare-parts">Spare Parts</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Brand</label>
                                <input type="text" id="p-brand" placeholder="e.g. Samsung" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price (৳) *</label>
                                <input type="number" id="p-price" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-red outline-none dark:bg-gray-800 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Original Price (৳)</label>
                                <input type="number" id="p-original-price" placeholder="For discount calculation" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Stock Quantity</label>
                                <input type="number" id="p-stock" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select id="p-status" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none bg-white dark:bg-gray-800 dark:text-white">
                                    <option value="Active">Active</option>
                                    <option value="Draft">Draft</option>
                                    <option value="Out of Stock">Out of Stock</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Details & Images Tab -->
                    <div id="tab-details" class="tab-content hidden space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Product Images</label>
                            <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:bg-gray-100 dark:hover:bg-gray-800 transition cursor-pointer relative">
                                <input type="file" id="p-images" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="handleImageUpload(this)">
                                <i class="ph ph-image text-3xl text-gray-400 mb-2"></i>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Click to upload multiple images. First image is main.</p>
                            </div>
                            <div id="image-previews" class="flex gap-2 mt-4 overflow-x-auto min-h-[80px] items-center"></div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Description</label>
                            <textarea id="p-desc" rows="6" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-red outline-none dark:bg-gray-800 dark:text-white" placeholder="Detailed description..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Key Specifications</label>
                            <textarea id="p-specs" rows="3" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white" placeholder="e.g. Material: Cotton, Size: XL..."></textarea>
                        </div>
                    </div>
                    <!-- Shipping & Warranty Tab -->
                    <div id="tab-shipping" class="tab-content hidden space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Delivery Costs (৳)</label>
                                <input type="number" id="p-delivery-fee" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white" placeholder="60">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Delivery Time</label>
                                <input type="text" id="p-delivery-time" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white" placeholder="3 - 5 Days">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Warranty Type</label>
                                <select id="p-warranty" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none bg-white dark:bg-gray-800 dark:text-white">
                                    <option value="No Warranty">No Warranty</option>
                                    <option value="Brand Warranty">Brand Warranty</option>
                                    <option value="Seller Warranty">Seller Warranty</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Return Policy</label>
                                <input type="text" id="p-return" class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg outline-none dark:bg-gray-800 dark:text-white" placeholder="7 Days Returns">
                            </div>
                            <div class="md:col-span-2">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="p-free-shipping" class="h-4 w-4 text-brand-red rounded border-gray-300 focus:ring-brand-red">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">Free Shipping Available</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-4 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end gap-3">
                <button type="button" onclick="toggleModal('productModal', false)" class="px-6 py-2 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">Cancel</button>
                <button type="button" onclick="submitProductForm()" class="px-6 py-2 bg-brand-red text-white font-bold rounded-lg hover:bg-red-700 shadow-md transition-colors">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-40 backdrop-blur-sm" onclick="toggleModal('orderDetailsModal', false)"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col animate-fade-in m-4 md:m-0">
            <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Order Details</h3>
                <button onclick="toggleModal('orderDetailsModal', false)" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"><i class="ph ph-x text-xl"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50 dark:bg-gray-900 space-y-8">
                <!-- Order Header -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700"><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Order ID</p><p class="text-lg font-bold text-gray-900 dark:text-white" id="modal-order-id">-</p></div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700"><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Order Date</p><p class="text-lg font-bold text-gray-900 dark:text-white" id="modal-order-date">-</p></div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700"><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Order Status</p><p class="text-lg font-bold" id="modal-order-status">-</p></div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700"><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Total Amount</p><p class="text-lg font-bold text-gray-900 dark:text-white" id="modal-order-total">৳0</p></div>
                </div>

                <!-- Customer Information -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-100 dark:border-gray-700">
                    <h4 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><i class="ph ph-user text-brand-red"></i> Customer Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Full Name</p><p class="text-gray-900 dark:text-white font-medium" id="modal-cust-name">-</p></div>
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Phone Number</p><p class="text-gray-900 dark:text-white font-medium" id="modal-cust-phone">-</p></div>
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Email Address</p><p class="text-gray-900 dark:text-white font-medium" id="modal-cust-email">-</p></div>
                    </div>
                </div>

                <!-- Billing Address -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-100 dark:border-gray-700">
                    <h4 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><i class="ph ph-map-pin text-brand-red"></i> Billing Address</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Street Address</p><p class="text-gray-900 dark:text-white font-medium" id="modal-addr-street">-</p></div>
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">City</p><p class="text-gray-900 dark:text-white font-medium" id="modal-addr-city">-</p></div>
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Postal Code</p><p class="text-gray-900 dark:text-white font-medium" id="modal-addr-postal">-</p></div>
                    </div>
                </div>

                <!-- Payment Information -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-100 dark:border-gray-700">
                    <h4 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><i class="ph ph-credit-card text-brand-red"></i> Payment Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Payment Method</p><p class="text-gray-900 dark:text-white font-medium" id="modal-payment-method">-</p></div>
                        <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Payment Status</p><p class="text-gray-900 dark:text-white font-medium" id="modal-payment-status">-</p></div>
                    </div>
                    <!-- Bank Payment Details (if applicable) -->
                    <div id="modal-bank-details" class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 hidden">
                        <p class="text-sm font-semibold text-gray-800 dark:text-white mb-3">Bank Transfer Details</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Bank Name</p><p class="text-gray-900 dark:text-white font-medium" id="modal-bank-name">-</p></div>
                            <div><p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">Account Number</p><p class="text-gray-900 dark:text-white font-medium font-mono" id="modal-bank-account">-</p></div>
                        </div>
                        <div id="modal-bank-doc" class="mt-4 hidden">
                            <p class="text-sm font-semibold text-gray-800 dark:text-white mb-2">Payment Proof Document</p>
                            <img id="modal-bank-doc-img" src="" alt="Bank Document" class="w-full h-auto rounded-lg border border-gray-200 dark:border-gray-600 max-h-96 object-contain cursor-pointer">
                        </div>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-100 dark:border-gray-700">
                    <h4 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><i class="ph ph-shopping-cart text-brand-red"></i> Order Items</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"><tr><th class="px-4 py-3">Product</th><th class="px-4 py-3">Quantity</th><th class="px-4 py-3">Price</th><th class="px-4 py-3 text-right">Subtotal</th></tr></thead>
                            <tbody id="modal-order-items" class="divide-y divide-gray-200 dark:divide-gray-700"><tr><td colspan="4" class="px-4 py-4 text-center">No items</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="p-6 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end gap-3">
                <button type="button" onclick="toggleModal('orderDetailsModal', false)" class="px-6 py-2 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">Close</button>
                <button type="button" onclick="printOrder()" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2"><i class="ph ph-printer"></i> Print Invoice</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. SETUP & AUTH & INIT ---
        let adminCredentials = JSON.parse(localStorage.getItem('admin_credentials')) || { username: 'admin', password: 'Ilovemoney' };
        let products = JSON.parse(localStorage.getItem('admin_products') || '[]');
        let orders = JSON.parse(localStorage.getItem('admin_orders') || '[]');
        // (Other init variables assumed same as before)
        let tempImages = [];
        let tempFeaturedIndex = 0;
        let currentProductPage = 1;
        const productsPerPage = 10;

        function checkAuth() {
            const currentUser = sessionStorage.getItem('isAdminAuthenticated');
            if (currentUser) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                initApp();
                // Check if running on file protocol
                if (window.location.protocol === 'file:') {
                    console.warn("Running on file:// protocol. LocalStorage events might not work across tabs.");
                }
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }
        }
        function initApp() { 
            renderTables(); 
            renderStats(); 
            initCharts();
            // Listen for cross-tab updates
            window.addEventListener('storage', handleStorageChange);
        }
        
        function handleStorageChange(e) {
            if (e.key === 'admin_orders') {
                orders = JSON.parse(e.newValue || '[]');
                renderTables();
                renderStats();
                showToast('New order received!', 'success');
            } else if (e.key === 'admin_products') {
                products = JSON.parse(e.newValue || '[]');
                renderTables();
                renderStats();
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgClass = type === 'success' ? 'bg-green-600' : 'bg-blue-600';
            toast.className = `${bgClass} text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full flex items-center gap-2`;
            toast.innerHTML = `<i class="ph ${type === 'success' ? 'ph-check-circle' : 'ph-info'} text-lg"></i> ${message}`;
            container.appendChild(toast);
            
            // Animate in
            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-full');
            });

            setTimeout(() => {
                toast.classList.add('translate-x-full');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 3000);
        }

        function logout() { sessionStorage.removeItem('isAdminAuthenticated'); window.location.reload(); }
        
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u===adminCredentials.username && p===adminCredentials.password) {
                sessionStorage.setItem('isAdminAuthenticated', 'true|Super Admin');
                checkAuth();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        // --- NAVIGATION & MODALS ---
        function showSection(id) {
            ['dashboard', 'products', 'orders', 'websites', 'users', 'finance', 'reviews', 'marketing', 'settings'].forEach(sid => {
                document.getElementById('section-' + sid)?.classList.add('hidden');
                document.getElementById('nav-' + sid)?.classList.remove('active');
            });
            document.getElementById('section-' + id)?.classList.remove('hidden');
            document.getElementById('nav-' + id)?.classList.add('active');
            document.getElementById('page-title').innerText = id.charAt(0).toUpperCase() + id.slice(1);
        }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); document.getElementById('mobile-overlay').classList.toggle('hidden'); }
        function toggleSidebarOnMobile() { if(window.innerWidth < 768) toggleSidebar(); }
        function toggleModal(id, show) {
            const el = document.getElementById(id);
            if(show) el.classList.remove('hidden'); else el.classList.add('hidden');
        }
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            // Hacky way to find button based on onclick string, assume standard layout
            const btns = document.querySelectorAll('.tab-btn');
            btns.forEach(b => { if(b.getAttribute('onclick').includes(tabId)) b.classList.add('active'); });
        }

        // --- DATA & RENDERING ---
        function renderStats() {
            document.getElementById('dash-products').innerText = products.length;
            document.getElementById('dash-orders').innerText = orders.length;
            const total = orders.reduce((acc, o) => acc + (o.total || 0), 0);
            document.getElementById('dash-sales').innerText = '৳' + total.toLocaleString();
        }

        function renderTables() {
            // Products
            const totalPages = Math.ceil(products.length / productsPerPage);
            if (currentProductPage > totalPages && totalPages > 0) currentProductPage = totalPages;
            if (currentProductPage < 1) currentProductPage = 1;

            const start = (currentProductPage - 1) * productsPerPage;
            const end = start + productsPerPage;
            const paginatedProducts = products.slice(start, end);

            document.getElementById('product-list-body').innerHTML = paginatedProducts.map(p => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-50 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium dark:text-white">${p.name}</td>
                    <td class="px-6 py-4 dark:text-gray-300">${p.categoryId || '-'}</td>
                    <td class="px-6 py-4 font-bold dark:text-white">৳${p.price}</td>
                    <td class="px-6 py-4 dark:text-gray-300">${p.stock || 0}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs bg-gray-100 dark:bg-gray-600 dark:text-white">${p.status || 'Active'}</span></td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="openProductModal(${p.id})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteProduct(${p.id})" class="text-red-500 hover:text-red-700">Delete</button>
                    </td>
                </tr>`).join('');

            // Update Pagination UI
            document.getElementById('pagination-info').innerText = products.length > 0 
                ? `Showing ${start + 1}-${Math.min(end, products.length)} of ${products.length}`
                : 'No products found';
            
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            
            if(btnPrev) {
                btnPrev.disabled = currentProductPage === 1;
                btnPrev.classList.toggle('opacity-50', currentProductPage === 1);
                btnPrev.classList.toggle('cursor-not-allowed', currentProductPage === 1);
            }
            
            if(btnNext) {
                btnNext.disabled = currentProductPage === totalPages || totalPages === 0;
                btnNext.classList.toggle('opacity-50', currentProductPage === totalPages || totalPages === 0);
                btnNext.classList.toggle('cursor-not-allowed', currentProductPage === totalPages || totalPages === 0);
            }

            // Orders
            document.getElementById('order-list-body').innerHTML = orders.map(o => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-50 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium text-blue-600 cursor-pointer" onclick="viewOrderDetails('${o.id}')">#${o.id}</td>
                    <td class="px-6 py-4 dark:text-gray-300">${o.customerName || o.customer || 'Guest'}</td>
                    <td class="px-6 py-4 dark:text-gray-300">${o.paymentMethod || o.paymentInfo?.method || 'N/A'}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs bg-blue-100 text-blue-800">${o.status}</span></td>
                    <td class="px-6 py-4 text-right font-bold dark:text-white">৳${(o.total||0).toLocaleString()}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="viewOrderDetails('${o.id}')" class="text-gray-500 hover:text-gray-700"><i class="ph ph-eye text-lg"></i></button>
                    </td>
                </tr>`).join('');
        }

        function prevProductPage() {
            if (currentProductPage > 1) {
                currentProductPage--;
                renderTables();
            }
        }

        function nextProductPage() {
            const totalPages = Math.ceil(products.length / productsPerPage);
            if (currentProductPage < totalPages) {
                currentProductPage++;
                renderTables();
            }
        }

        // --- PRODUCT LOGIC ---
        function openProductModal(id) {
            const form = document.getElementById('productForm');
            form.reset();
            tempImages = [];
            document.getElementById('image-previews').innerHTML = '';
            document.getElementById('p-id').value = '';
            document.getElementById('productModalTitle').innerText = 'Add New Product';

            if(id) {
                const p = products.find(prod => prod.id == id);
                if(p) {
                    document.getElementById('productModalTitle').innerText = 'Edit Product';
                    document.getElementById('p-id').value = p.id;
                    document.getElementById('p-name').value = p.name;
                    document.getElementById('p-category').value = p.categoryId || 'electronics';
                    document.getElementById('p-brand').value = p.brand || '';
                    document.getElementById('p-price').value = p.price;
                    document.getElementById('p-original-price').value = p.originalPrice || '';
                    document.getElementById('p-stock').value = p.stock || '';
                    document.getElementById('p-status').value = p.status || 'Active';
                    document.getElementById('p-desc').value = p.description || '';
                    document.getElementById('p-specs').value = p.specifications || '';
                    document.getElementById('p-delivery-fee').value = p.deliveryFee || '';
                    document.getElementById('p-delivery-time').value = p.deliveryTime || '';
                    document.getElementById('p-warranty').value = p.warranty || 'No Warranty';
                    document.getElementById('p-return').value = p.returnPolicy || '';
                    document.getElementById('p-free-shipping').checked = !!p.freeShipping;
                    
                    if(p.images) tempImages = [...p.images];
                    else if(p.imageUrl) tempImages = [p.imageUrl];
                    renderImagePreviews();
                }
            }
            switchTab('tab-general');
            toggleModal('productModal', true);
        }

        function submitProductForm() {
            const id = document.getElementById('p-id').value;
            const name = document.getElementById('p-name').value;
            const price = Number(document.getElementById('p-price').value);
            if(!name || !price) return alert('Name and Price required');

            const pData = {
                id: id ? Number(id) : Date.now(),
                name,
                categoryId: document.getElementById('p-category').value,
                brand: document.getElementById('p-brand').value,
                price,
                originalPrice: Number(document.getElementById('p-original-price').value) || undefined,
                stock: Number(document.getElementById('p-stock').value) || 0,
                status: document.getElementById('p-status').value,
                description: document.getElementById('p-desc').value,
                specifications: document.getElementById('p-specs').value,
                deliveryFee: Number(document.getElementById('p-delivery-fee').value) || 0,
                deliveryTime: document.getElementById('p-delivery-time').value,
                warranty: document.getElementById('p-warranty').value,
                returnPolicy: document.getElementById('p-return').value,
                freeShipping: document.getElementById('p-free-shipping').checked,
                images: tempImages,
                imageUrl: tempImages.length > 0 ? tempImages[0] : 'https://via.placeholder.com/150'
            };

            if(id) {
                const idx = products.findIndex(p => p.id == id);
                if(idx !== -1) products[idx] = { ...products[idx], ...pData };
            } else {
                products.unshift(pData);
            }
            localStorage.setItem('admin_products', JSON.stringify(products));
            renderTables();
            renderStats();
            toggleModal('productModal', false);
        }

        function handleImageUpload(input) {
            if(input.files) {
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        tempImages.push(e.target.result);
                        renderImagePreviews();
                    };
                    reader.readAsDataURL(file);
                });
            }
        }
        function renderImagePreviews() {
            document.getElementById('image-previews').innerHTML = tempImages.map((src,i) => `
                <div class="relative w-20 h-20 border rounded overflow-hidden">
                    <img src="${src}" class="w-full h-full object-cover">
                    <button onclick="removeImage(${i})" class="absolute top-0 right-0 bg-red-500 text-white w-5 h-5 flex items-center justify-center text-xs">×</button>
                </div>
            `).join('');
        }
        function removeImage(i) { tempImages.splice(i,1); renderImagePreviews(); }
        function deleteProduct(id) { if(confirm('Delete?')) { products = products.filter(p => p.id != id); localStorage.setItem('admin_products', JSON.stringify(products)); renderTables(); renderStats(); } }

        // --- ORDER LOGIC ---
        function viewOrderDetails(id) {
            const ord = orders.find(o => o.id == id);
            if (!ord) return alert('Order not found');

            document.getElementById('modal-order-id').innerText = ord.id;
            document.getElementById('modal-order-date').innerText = ord.orderDate || new Date().toLocaleDateString();
            document.getElementById('modal-order-status').innerText = ord.status;
            document.getElementById('modal-order-total').innerText = '৳' + (ord.total || 0).toLocaleString();

            document.getElementById('modal-cust-name').innerText = ord.customerName || ord.customer || '-';
            document.getElementById('modal-cust-phone').innerText = ord.customerPhone || '-';
            document.getElementById('modal-cust-email').innerText = ord.customerEmail || '-';

            const addr = ord.billingAddress || {};
            document.getElementById('modal-addr-street').innerText = addr.street || '-';
            document.getElementById('modal-addr-city').innerText = addr.city || '-';
            document.getElementById('modal-addr-postal').innerText = addr.postalCode || '-';

            const pay = ord.paymentInfo || {};
            document.getElementById('modal-payment-method').innerText = pay.method || ord.paymentMethod || '-';
            document.getElementById('modal-payment-status').innerText = pay.status || '-';

            const bankSection = document.getElementById('modal-bank-details');
            if(pay.method === 'Bank Transfer' || pay.bankDetails) {
                bankSection.classList.remove('hidden');
                const bank = pay.bankDetails || {};
                document.getElementById('modal-bank-name').innerText = bank.bankName || '-';
                document.getElementById('modal-bank-account').innerText = bank.accountNumber || '-';
                
                const docSection = document.getElementById('modal-bank-doc');
                const docImg = document.getElementById('modal-bank-doc-img');
                if(bank.documentImage) {
                    docSection.classList.remove('hidden');
                    docImg.src = bank.documentImage;
                    docImg.onclick = () => { 
                        const w = window.open("");
                        w.document.write(`<img src="${bank.documentImage}" style="width:100%">`);
                    };
                } else {
                    docSection.classList.add('hidden');
                }
            } else {
                bankSection.classList.add('hidden');
            }

            document.getElementById('modal-order-items').innerHTML = (ord.items || []).map(item => `
                <tr>
                    <td class="px-4 py-3 dark:text-gray-300">${item.name} <br> <span class="text-xs text-gray-500">${item.variant||''}</span></td>
                    <td class="px-4 py-3 dark:text-gray-300">${item.quantity}</td>
                    <td class="px-4 py-3 dark:text-gray-300">৳${item.price}</td>
                    <td class="px-4 py-3 text-right font-medium dark:text-white">৳${item.price * item.quantity}</td>
                </tr>
            `).join('');

            toggleModal('orderDetailsModal', true);
        }

        function printOrder() {
            const id = document.getElementById('modal-order-id').innerText;
            const ord = orders.find(o => o.id == id);
            if(!ord) return;

            const itemsHtml = (ord.items || []).map(item => `
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${item.name} (${item.variant || ''})</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${item.quantity}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">৳${item.price}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">৳${item.price * item.quantity}</td>
                </tr>
            `).join('');

            let proofImg = '';
            if(ord.paymentInfo?.bankDetails?.documentImage) {
                proofImg = `<div style="margin-top: 20px; page-break-inside: avoid;"><h3>Payment Proof</h3><img src="${ord.paymentInfo.bankDetails.documentImage}" style="max-width: 100%; max-height: 400px; border: 1px solid #eee;"></div>`;
            }

            const win = window.open('', '', 'width=800,height=800');
            win.document.write(`
                <html><head><title>Invoice #${id}</title><style>
                    body { font-family: sans-serif; padding: 40px; color: #333; }
                    .header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid #E50044; padding-bottom: 20px; }
                    h1 { color: #E50044; margin: 0; }
                    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
                    h3 { font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; color: #E50044; }
                    .row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th { text-align: left; background: #f9f9f9; padding: 10px; border-bottom: 1px solid #ddd; }
                    .total { text-align: right; margin-top: 20px; font-size: 18px; font-weight: bold; color: #E50044; }
                </style></head><body>
                    <div class="header"><h1>NOKLITY</h1><p>Order #${id}</p><p>Date: ${new Date(ord.orderDate || Date.now()).toLocaleDateString()}</p></div>
                    <div class="grid">
                        <div><h3>Customer</h3><div class="row"><span>Name:</span><span>${ord.customerName || ord.customer}</span></div><div class="row"><span>Phone:</span><span>${ord.customerPhone}</span></div></div>
                        <div><h3>Shipping</h3><div class="row"><span>Address:</span><span>${ord.billingAddress?.street || '-'}</span></div><div class="row"><span>City:</span><span>${ord.billingAddress?.city || '-'}</span></div></div>
                    </div>
                    <div><h3>Items</h3><table><thead><tr><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead><tbody>${itemsHtml}</tbody></table></div>
                    <div class="total">Total: ৳${(ord.total||0).toLocaleString()}</div>
                    <div style="margin-top: 30px;"><h3>Payment</h3><div class="row"><span>Method:</span><span>${ord.paymentInfo?.method || ord.paymentMethod || '-'}</span></div><div class="row"><span>Status:</span><span>${ord.paymentInfo?.status || '-'}</span></div></div>
                    ${proofImg}
                    <script>window.onload = function() { window.print(); }</script>
                </body></html>
            `);
            win.document.close();
        }

        // Init Chart placeholder
        function initCharts() {
            const ctx = document.getElementById('revenueChart');
            if(ctx) new Chart(ctx, { type: 'line', data: { labels: ['M','T','W','T','F','S','S'], datasets: [{ label: 'Revenue', data: [1200, 1900, 300, 500, 200, 300, 4500], borderColor: '#E50044', backgroundColor: 'rgba(229, 0, 68, 0.1)', fill: true }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } } });
            const ctx2 = document.getElementById('targetChart');
            if(ctx2) new Chart(ctx2, { type: 'doughnut', data: { labels: ['Done', 'Left'], datasets: [{ data: [75, 25], backgroundColor: ['#E50044', '#F3F4F6'], borderWidth: 0, cutout: '85%' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } } } });
        }

        checkAuth();
    </script>
</body>
</html>
